<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Panel | Peso App</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">

<style>
:root{
    --bg:#0f172a;
    --card:#1e293b;
    --card-soft:#24304a;
    --text:#f8fafc;
    --muted:#94a3b8;
    --primary:#6366f1;
    --success:#4ade80;
    --danger:#ef4444;
    --warning:#fbbf24;
}

*{box-sizing:border-box;margin:0;padding:0}

body{
    font-family:'Inter',sans-serif;
    background:radial-gradient(circle at top,#1e293b,#020617);
    color:var(--text);
    padding:40px 20px;
}

.panel{
    max-width:1000px;
    margin:0 auto;
    background:linear-gradient(180deg,#1e293b,#0f172a);
    border-radius:28px;
    padding:36px;
    box-shadow:0 40px 80px rgba(0,0,0,.6);
}

/* ---------- HEADER ---------- */
.header{
    display:flex;
    justify-content:space-between;
    align-items:center;
    margin-bottom:35px;
    padding-bottom:20px;
    border-bottom:1px solid rgba(148,163,184,.15);
}

.header h1{
    font-size:2.2rem;
    font-weight:800;
}

.status{
    font-size:.85rem;
    padding:6px 16px;
    border-radius:999px;
    background:linear-gradient(135deg,#fb923c,#f97316);
    color:#020617;
    font-weight:700;
}

/* ---------- STATS ---------- */
.stats{
    display:grid;
    grid-template-columns:repeat(3,1fr);
    gap:20px;
    margin-bottom:35px;
}

.stat{
    background:linear-gradient(180deg,#334155,#1e293b);
    padding:26px;
    border-radius:22px;
    text-align:center;
    box-shadow:0 10px 30px rgba(0,0,0,.35);
}

.stat-value{
    font-size:1.8rem;
    font-weight:800;
}

.stat-label{
    font-size:.9rem;
    color:var(--muted);
    margin-top:6px;
}

/* ---------- FORM ---------- */
.form-card{
    background:var(--card-soft);
    padding:26px;
    border-radius:22px;
    margin-bottom:35px;
}

label{
    display:block;
    font-size:.85rem;
    color:var(--muted);
    margin-bottom:6px;
}

input{
    width:100%;
    padding:14px;
    border-radius:12px;
    border:none;
    margin-bottom:16px;
    background:#020617;
    color:var(--text);
}

button{
    width:100%;
    padding:14px;
    background:linear-gradient(135deg,#14b8a6,#06b6d4);
    border:none;
    border-radius:12px;
    font-weight:700;
    cursor:pointer;
}

/* ---------- FLASH ---------- */
.flash{
    padding:14px 18px;
    border-radius:14px;
    margin-bottom:18px;
    font-weight:600;
}

.flash.error{background:#7f1d1d}
.flash.success{background:#14532d}

/* ---------- HISTORIAL ---------- */
.historial{
    background:var(--card-soft);
    padding:26px;
    border-radius:22px;
    margin-bottom:35px;
}

.historial h3{
    margin-bottom:15px;
}

.item{
    display:flex;
    justify-content:space-between;
    padding:12px 0;
    border-bottom:1px solid rgba(148,163,184,.15);
    color:var(--muted);
}

/* ---------- CHART ---------- */
.chart-card{
    background:linear-gradient(180deg,#1e293b,#0f172a);
    padding:26px;
    border-radius:26px;
    box-shadow:0 20px 50px rgba(0,0,0,.45);
}

canvas{
    margin-top:10px;
}

/* ---------- LINKS ---------- */
.links{
    margin-top:30px;
    text-align:center;
}

.links a{
    color:#818cf8;
    text-decoration:none;
}
</style>
</head>
<body>

<div class="panel">

    <!-- HEADER -->
    <div class="header">
        <h1>Panel</h1>
        <div class="status">{{ estado }}</div>
    </div>

    <!-- STATS -->
    <div class="stats">
        <div class="stat">
            <div class="stat-value">{{ peso_actual }} kg</div>
            <div class="stat-label">Peso actual</div>
        </div>
        <div class="stat">
            <div class="stat-value">{{ imc }}</div>
            <div class="stat-label">IMC</div>
        </div>
        <div class="stat">
            <div class="stat-value" style="color:{{ color_estado }}">{{ estado }}</div>
            <div class="stat-label">Estado</div>
        </div>
    </div>

    <!-- FORM -->
    <div class="form-card">
        {% with messages = get_flashed_messages(with_categories=true) %}
        {% for category,msg in messages %}
            <div class="flash {{ category }}">{{ msg }}</div>
        {% endfor %}
        {% endwith %}

        <form method="POST" action="/registro">
            <label>Peso (kg)</label>
            <input type="number" step="0.01" name="peso" required>

            <label>Fecha</label>
            <input type="date" name="fecha" required>

            <button>Guardar registro</button>
        </form>
    </div>

    <!-- HISTORIAL -->
    <div class="historial">
        <h3>Historial</h3>

        {% if registros %}
            {% for r in registros %}
            <div class="item">
                <span>{{ r[2] }}</span>
                <span>{{ r[1] }} kg</span>
            </div>
            {% endfor %}
        {% else %}
            <p style="color:var(--muted)">No hay registros aún.</p>
        {% endif %}
    </div>

    <!-- CHART -->
    {% if registros %}
    <div class="chart-card">
        <canvas id="chart"></canvas>
    </div>
    {% endif %}

    <div class="links">
        <a href="/logout">Cerrar sesión</a>
    </div>

</div>

{% if registros %}
<script>
const labels = {{ labels | tojson | safe }};
const data = {{ data | tojson | safe }};

new Chart(document.getElementById('chart'), {
    type: 'line',
    data: {
        labels: labels,
        datasets: [{
            data: data,
            borderColor: '#a5b4fc',
            backgroundColor: 'rgba(99,102,241,.35)',
            borderWidth: 4,
            tension: .45,
            fill: true,
            pointRadius: 0,
            pointHoverRadius: 7,
            pointBackgroundColor: '#e0e7ff'
        }]
    },
    options: {
        animation: { duration: 1400, easing: 'easeOutQuart' },
        plugins: {
            legend: { display: false },
            tooltip: {
                backgroundColor: '#020617',
                titleColor: '#e5e7eb',
                bodyColor: '#f8fafc',
                padding: 14,
                cornerRadius: 12
            }
        },
        scales: {
            x: {
                grid: { display: false },
                ticks: { color: '#94a3b8' }
            },
            y: {
                grid: { color: 'rgba(148,163,184,.15)' },
                ticks: { color: '#94a3b8' }
            }
        }
    }
});
</script>
{% endif %}

</body>
</html>
